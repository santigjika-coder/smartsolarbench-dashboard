<!DOCTYPE html>
<html>
<head>
    <title>Smart Bench Berat - Live Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.2.9/justgage.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #eceff1; margin: 0; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 30px; }
        .gauge-card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 280px; }
        h1 { color: #2c3e50; }
        .status { font-size: 0.9em; color: #7f8c8d; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>ğŸ“Š Monitorimi Live - Parku Berat</h1>
    <p>TÃ« dhÃ«nat azhurnohen automatikisht Ã§do 15 sekonda.</p>

    <div class="container">
        <div class="gauge-card"><div id="temp"></div></div>
        <div class="gauge-card"><div id="hum"></div></div>
        <div class="gauge-card"><div id="pres"></div></div>
        <div class="gauge-card"><div id="gas"></div></div>
    </div>

    <p class="status" id="update-time">Duke pritur tÃ« dhÃ«nat...</p>

    <script>
        // Krijimi i Gauges
        var gTemp = new JustGage({ id: "temp", value: 0, min: -10, max: 50, title: "Temperatura (Â°C)", label: "GradÃ«", colorSteps: ['#a2d9ff', '#ffeb3b', '#ff5722'] });
        var gHum = new JustGage({ id: "hum", value: 0, min: 0, max: 100, title: "LagÃ«shtia (%)", label: "%", colorSteps: ['#e1f5fe', '#03a9f4', '#01579b'] });
        var gPres = new JustGage({ id: "pres", value: 0, min: 900, max: 1100, title: "Presioni (hPa)", label: "hPa", levelColors: ["#ff9800"] });
        var gGas = new JustGage({ id: "gas", value: 0, min: 0, max: 500, title: "CilÃ«sia e Ajrit (kÎ©)", label: "Rezistenca", levelColors: ["#4caf50"] });

        function updateData() {
            // KÃ«tu marrim tÃ« dhÃ«nat nga kanali yt 3255086
            fetch('https://api.thingspeak.com/channels/3255086/feeds.json?results=1')
            .then(response => response.json())
            .then(data => {
                const lastFeed = data.feeds[0];
                
                // RifreskojmÃ« vlerat
                if(lastFeed.field1) gTemp.refresh(parseFloat(lastFeed.field1).toFixed(1));
                if(lastFeed.field2) gHum.refresh(parseFloat(lastFeed.field2).toFixed(0));
                if(lastFeed.field3) gPres.refresh(parseFloat(lastFeed.field3).toFixed(0));
                if(lastFeed.field4) gGas.refresh(parseFloat(lastFeed.field4).toFixed(1));

                document.getElementById('update-time').innerHTML = "PÃ«rditÃ«simi i fundit: " + new Date(lastFeed.created_at).toLocaleString();
            })
            .catch(err => {
                console.error("Gabim gjatÃ« marrjes sÃ« tÃ« dhÃ«nave:", err);
                document.getElementById('update-time').innerHTML = "Gabim: Nuk mund tÃ« lidhem me ThingSpeak.";
            });
        }

        // Fillo update-in
        updateData();
        setInterval(updateData, 15000); 
    </script>
</body>
</html>
