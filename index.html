<!DOCTYPE html>
<html>
<head>
    <title>Smart Bench Berat - Live Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.2.9/justgage.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #eceff1; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .gauge-card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 250px; }
        #debug-box { margin-top: 20px; font-size: 12px; color: #666; background: #ddd; padding: 10px; display: inline-block; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>ðŸ“Š Monitorimi Live - Parku Berat</h1>
    
    <div class="container">
        <div class="gauge-card"><div id="temp"></div></div>
        <div class="gauge-card"><div id="hum"></div></div>
        <div class="gauge-card"><div id="pres"></div></div>
        <div class="gauge-card"><div id="gas"></div></div>
    </div>

    <p id="update-time">Duke u lidhur...</p>
    
    <div id="debug-box">Statusi: Duke pritur tÃ« dhÃ«nat...</div>

    <script>
        var gTemp = new JustGage({ id: "temp", value: 0, min: -10, max: 50, title: "Temperatura", label: "Â°C" });
        var gHum = new JustGage({ id: "hum", value: 0, min: 0, max: 100, title: "LagÃ«shtia", label: "%" });
        var gPres = new JustGage({ id: "pres", value: 0, min: 900, max: 1100, title: "Presioni", label: "hPa" });
        var gGas = new JustGage({ id: "gas", value: 0, min: 0, max: 500, title: "Gazi", label: "kÎ©" });

        function updateData() {
            // ShtojmÃ« njÃ« "cache buster" (&_=@Date.now()) qÃ« ThingSpeak tÃ« mos na japÃ« tÃ« dhÃ«na tÃ« vjetra
            fetch('https://api.thingspeak.com/channels/3255086/feeds.json?results=1&_=' + Date.now())
            .then(response => response.json())
            .then(data => {
                const lastFeed = data.feeds[0];
                console.log("TÃ« dhÃ«nat e fundit:", lastFeed); // Shohim nÃ« console

                // Update Gauges - i kthejmÃ« nÃ« numra me Number()
                if(lastFeed.field1 !== null) gTemp.refresh(Number(lastFeed.field1));
                if(lastFeed.field2 !== null) gHum.refresh(Number(lastFeed.field2));
                if(lastFeed.field3 !== null) gPres.refresh(Number(lastFeed.field3));
                if(lastFeed.field4 !== null) gGas.refresh(Number(lastFeed.field4));

                document.getElementById('update-time').innerHTML = "PÃ«rditÃ«simi: " + new Date(lastFeed.created_at).toLocaleString();
                document.getElementById('debug-box').innerHTML = "MarrÃ« nga ThingSpeak: F1:" + lastFeed.field1 + " F2:" + lastFeed.field2;
            })
            .catch(err => {
                document.getElementById('debug-box').innerHTML = "Gabim: " + err;
            });
        }

        setInterval(updateData, 15000);
        updateData();
    </script>
</body>
</html>
